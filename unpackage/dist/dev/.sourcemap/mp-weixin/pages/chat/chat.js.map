{"version":3,"sources":["uni-app:///main.js",null,"webpack:////Users/gulihua/tmp/wxmini-chatgpt/pages/chat/chat.nvue?2412","webpack:////Users/gulihua/tmp/wxmini-chatgpt/pages/chat/chat.nvue?29e0","webpack:////Users/gulihua/tmp/wxmini-chatgpt/pages/chat/chat.nvue?7e58","uni-app:///pages/chat/chat.nvue","webpack:////Users/gulihua/tmp/wxmini-chatgpt/pages/chat/chat.nvue?88a9","webpack:////Users/gulihua/tmp/wxmini-chatgpt/pages/chat/chat.nvue?241f","webpack:////Users/gulihua/tmp/wxmini-chatgpt/pages/chat/chat.nvue?3293","webpack:////Users/gulihua/tmp/wxmini-chatgpt/pages/chat/chat.nvue?9086"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","systemInfo","baseUrl","toUid","sessionId","footAnimationData","scrollAnimationData","title","chatSrcollBottom","KeyboardHeight","safeBottom","adjustPosition","msgList","msg","scrollTop","srcollHeight","chatDetailHeight","willStop","initPoint","identifier","Y","chatDetailBoxMaxWidth","focus","refreshing","ready","isWxapp","isLogin","loading","loginType","navTip","source","parentId","token","isDone","isFirst","destroyed","onLoad","onShow","uni","onReady","onShareAppMessage","path","imageUrl","onShareTimeline","onPullDownRefresh","computed","chatBodyBottom","onHide","methods","onMessage","message","setTimeout","that","onStatus","onKeyboardHeight","statusBarHeight","onpullingdown","translatePageTop","duration","timingFunction","scrollAnimation","footAnimation","inputScroll","eventType","exitExpression","props","element","property","expression","BindingX","scrollToBottom","hideKey","getEl","inputFocus","menuAnimation","sendMsg","content","html","isSend","isSuccess","createTime","id","role","msgParam","index","list","updateTime","session","getApp","sendMsg4Ai","isSender","getChatList","getChatListRes","header","console","url","success","fail","getChatListFromStore","update2Store","chatList","moderations","conversationId","method","getSessionListRes","genTitle","updateSessionList","getDemoChatListRes","showNotify","type","safeAreaInsetTop","showToast","position"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8H;AAC9H;AACyD;AACL;AACa;AACyB;;;AAG1F;AAC6M;AAC7M,gBAAgB,iNAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,4FAAM;AACR,EAAE,qGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,gGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACxBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,kRAEN;AACP,KAAK;AACL;AACA,aAAa,wRAEN;AACP,KAAK;AACL;AACA,aAAa,6SAEN;AACP,KAAK;AACL;AACA,aAAa,iPAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACrEA;AAAA;AAAA;AAAA;AAAozB,CAAgB,myBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;ACwFx0B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAGA;EACAC;IAAA;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IAAA,oDACA,kDACA,iDACA,oDACA,kDACA,mDACA,gDACA,4DACA,qDACA,2DACA,yDACA,0DACA,mDACA,+DACA,mDACA,sDACA,sDACA,sDACA,2DACA,wDACA;EAEA;EACAC,iCAEA;EACAC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;EACA;EACAC;IAEA;IAEA;IACA;IACA;IACA;IAEA;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;MACA;MACA;IACA;IACAC;IACAA;IACA;IACA;IACA;MACA;MACA;IACA;IACA;IACA;IACA;IACA;IACA;EACA;EACAC;IACA;IACA;EACA;EACAC;IACA;MACAjC;MACAkC;MACAC;IACA;EACA;EAEAC;IACA;MACApC;IACA;EACA;EACAqC;IACA;EAAA,CACA;EACAC;IACAC;MACA;IACA;EACA;EACAC,2BAEA;EACAC;IACAC;MACA;MACA;QACA;MACA;MACA;MACA;QACAC;MACA;MACA;MACA;QACA;UACA;YACA;YACA;YACA;YACA;YACA;cACA;gBACA;cACA;gBACA;cACA;YACA;cACA;YACA;UAEA;YACA;cACA;cACA;gBACArC;gBACAA;gBACA;gBACA;cACA;YACA;UACA;QACA;UACA;UACA;YACA;YACA;YACA;cACA;cACA;cACA;cACA;cACA;YACA;UAGA;QAEA;MAIA;MACA;QACA;QACA;UACA;YACA;YACA;cACA;YACA;cACA;gBACA;cACA;YACA;UAGA;UAEA;YACAsC;cACAC;YACA;UAEA;QACA;QACA;UACA;UACA;UACA;YACA;YACA;YACA;YACA;YACA;UACA;QACA;MAEA;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACAhB;QACA;QACA;UACA;YACA;YACA;YACA;;YAEA;YACA,sEACAiB;UAEA;YACA;YAEA;YACA,sEACAA;UAEA;QACA;UACA;YAEA;YACA;UACA;YACA;UACA;QACA;QACA;UACA;UACA;QACA;QACA;MACA;IACA;IACAC,8CAEA;IACAC;MAGA;QACAC;QACAC;MACA;MAEA;QACAD;QACAC;MACA;MACA;QACAC;QACAC;MACA;QACAD;QACAC;MACA;MAGA;MACA;IAkCA;IACAC;MACA;MACA;QACA;MACA;QACA;MACA;MACA;QACAC;QACAC;QACAC;UACAC;UACAC;UACAC;QACA;MACA;QACA;UACAC;YACArC;UACA;QACA;MACA;IACA;IACAsC;MAAA;MACA;QACAhC;UACA;UACA;YACA;UACA;QACA;MACA;IACA;IACA;IACAiC;MACAjC;MACA;IACA;IACA;IACAkC;MACA;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MACA;MAKA;QACA;QACA;UACAf;UACAC;QACA;QACAe;QAEA;MACA;IAuBA;IACAC;MACA;QACA;QACA;MACA;MACA;QACA;MACA;MACA;QACA;UACA;YACA;YACA;YACA;YACA;UAEA;YACA;UACA;QACA;MAEA;MACA;QACA;MACA;MAEA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACA;MACA;QACA;QACA;QACA;QACA;MACA;MACA;QACAlF;MACA;MACA;QACAA;MACA;MACA;QACAA;QACA;UACAkF;UACAN;QACA;QACA;QACAO;QACAnF;MACA;MAEA;QACA;QACA;UACA;QACA;QACA;UACAA;UACA;YACAA;YACA;YACA;cACAoF;YACA;YACA;cACA;cACA;gBACApF;cACA;YACA;UAEA;YACA;cACAkF;cACAN;YACA;YACA;YACAO;YACAnF;UACA;UACA;YACAA;YACAA;YACAA;UACA;QACA;QACA;UACAA;UACAA;QACA;QACA,wFACAI;UACA;UACA;UACA;YACAiF;UACA;UACA;YACAL;YACAM;YACAL;YACA1E;UACA;UACA,qFACA;YACA;YACAgF;UACA;UACAF;UACA/C;QACA;QACAtC;QACA;QACA;QACA;QACA;QACA;QACA;QACAwF;UACA;YACApC;YACAA;YACAA;UACA;QAEA;QACA;MAEA;MACA;MACA;QACA;MACA;IACA;IAEAqC;MAAA;MACA;QACA;MACA;MACA;QACAb;QACAC;QACAC;QACAE;QACAC;QACAC;MACA;MAEA;QACA;QACA;QACA;QACA;QACAQ;MACA;MACA;QACA1F;MACA;MACA;QACAA;QACAA;MACA;MACA;QACAA;QACAA;MACA;MACA;QACAA;MACA;MACA;QACA;UACAA;UACA;YACAA;YACA;YACA;cACAoF;YACA;YACA;cACA;cACA;gBACApF;cACA;YACA;UACA;YACA;cACAkF;cACAN;YACA;YACA;YACAO;YACAnF;UACA;QAGA;QACA;QACA;QACA;QACAA;QACAwF;UACA;YACApC;YACA;YACAA;UACA;QAEA;QAEA;UACA;QACA;UACA;QACA;MAEA;MACA;IACA;IACAuC;MACA;QACA;QACA;QACA;MACA;MACA;QACA;UACAf;UACAC;UACAC;UACAE;UACAC;UACAC;QACA;QAEA;QAEA;QACA;MACA;QACA;MACA;;MAEA;MACA;MACA;MACA;MACA;IAEA;;IAEAU;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACAtD;QACA/B;MACA;MACA;MACA;MACA;QACAsF;UACA;QACA;MACA;MACAC;MACAxD;QACAyD,2DACA3F;QACAJ;QACA6F;QACAG;UACA1D;UACAc;UACAd;UACA;YACA;cACAc;cACAA;cACAA;cACAA;YACA;UACA;YACAA;YACA;UACA;QAEA;QACA6C;UACA3D;UACAc;UACAd;UACA;QACA;MACA;IACA;IACA4D;MACA;MACA;MACA;QACAb;QACA;UAAA;UACA;QACA;MACA;MACA;QAEA;MAEA;MACA;IACA;IACAc;MACA;MACA;QACAC;MACA;MACAA;MACA9D;IACA;IAEA+D;MACA;QACAC;QACA1B;QACAK;MACA;MACA;MACA;MACA;QACAY;UACA;QACA;MACA;MACA;MACAvD;QACAyD;QACAQ;QACAvG;QACA6F;QACAG;UACA;YACAF;UACA;QACA;QACAG;UACAH;QACA;MACA;IACA;IACAU;MACA;QACA;MACA;MACA;MACA;MACA;MACA;QACAX;UACA;QACA;MACA;MACAC;MACAxD;QACAyD;QACA/F;QACA6F;QACAG;UACA;YACA;cAEA;gBACA5C;gBACA;kBACAd;gBACA;kBACA;kBACA;oBACA+C;oBACA/C;kBACA;gBACA;gBACA;gBACAc;gBACA;gBACAA;;gBAEA;cAEA;gBACAA;cACA;YAGA;UACA;YACA0C;UACA;QAEA;QACAG;UACAH;QACA;MACA;IAIA;IACAW;MACA;MACA;QACAH;QACArB;MACA;MACA;MACA;MACA;QACAY;UACA;QACA;MACA;MACAvD;QACAyD;QACAQ;QACAvG;QACA6F;QACAG;UACA;YACA;cACA5C;cACAA;cACA;cACA;gBACA;kBACAiC;kBACA/C;gBACA;kBACA+C;gBACA;cACA;YACA;YACA;UACA;YACAS;UACA;QACA;QACAG;UACAH;QACA;MACA;IACA;IACAY;MACA;QACA;MACA;MACA;MACA;QACA;UACA;UACA;YACAnB;YACA;UACA;QAEA;QACAjD;MACA;IAEA;IACAqE;MAAA;MACA;QACA;QACA;MACA;MACA;MACA;MACA;MACArE;QACA/B;MACA;MACAuF;MACAxD;QACAyD;QACA/F;QACAgG;UACA1D;UACAc;UACAd;UACAc;UACA;YACA;cAAA;cACAA;cACA;YACA;UACA;YACA0C;UACA;UACA1C;QACA;QACA6C;UACA3D;UACAA;UACAc;UACAA;UACA0C;QACA;MACA;IACA;IAEAc;MAEA;QACAC;QACA3D;QACAQ;QACAoD;MACA;IACA;IACAC;MAEA;QACA7D;QACA2D;QACAnD;QACAsD;MACA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC7hCA;AAAA;AAAA;AAAA;AAA2pC,CAAgB,gmCAAG,EAAC,C;;;;;;;;;;;ACA/qC;AACA,OAAO,KAAU,EAAE,kBAKd;;;;;;;;;;;;;ACNL;AAAA;AAAA;AAAA;AAA+hD,CAAgB,07CAAG,EAAC,C;;;;;;;;;;;ACAnjD;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chat/chat.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/chat/chat.nvue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.nvue?vue&type=template&id=6e1957d8&scoped=true&\"\nvar renderjs\nimport script from \"./chat.nvue?vue&type=script&lang=js&\"\nexport * from \"./chat.nvue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.nvue?vue&type=style&index=0&lang=css&\"\nimport style1 from \"./chat.nvue?vue&type=style&index=1&id=6e1957d8&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6e1957d8\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat.nvue\"\nexport default component.exports","export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=template&id=6e1957d8&scoped=true&\"","var components\ntry {\n  components = {\n    uniNavBar: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar\" */ \"@/uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.vue\"\n      )\n    },\n    uniChatDetail: function () {\n      return import(\n        /* webpackChunkName: \"components/uni-chat-detail/uni-chat-detail\" */ \"@/components/uni-chat-detail/uni-chat-detail.vue\"\n      )\n    },\n    uNotify: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-notify/u-notify\" */ \"@/uni_modules/uview-ui/components/u-notify/u-notify.vue\"\n      )\n    },\n    uToast: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-toast/u-toast\" */ \"@/uni_modules/uview-ui/components/u-toast/u-toast.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.msgList, function (item, index) {\n    var $orig = _vm.__get_orig(item)\n    var g0 = item.content.trim()\n    return {\n      $orig: $orig,\n      g0: g0,\n    }\n  })\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      return _vm.$store.state.utils.back()\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=script&lang=js&\"","<style>\n  view,\n  label,\n  swiper-item,\n  scroll-view {\n    display:flex;\n    flex-direction:column;\n    flex-shrink: 0;\n    flex-grow: 0;\n    flex-basis: auto;\n    align-items: stretch;\n    align-content: flex-start;\n  }\n  view,\n  image,\n  input,\n  scroll-view,\n  swiper,\n  swiper-item,\n  text,\n  textarea,\n  video {\n    position: relative;\n    border: 0px solid #000000;\n    box-sizing: border-box;\n  }\n  swiper-item {\n    position: absolute;\n  }\n  button {\n    margin: 0;\n  }\n</style>\n<template>\r\n\t<view>\r\n\t\t<view class=\"navbar\" ref=\"navbar\">\r\n\t\t\t<uni-nav-bar :status-bar=\"true\" :leftIconBool=\"true\" @clickLeft=\"$store.state.utils.back()\" left-icon=\"back\"\r\n\t\t\t\t:title=\"navTip\" :moveRightBtn=\"isWxapp\" background-color=\"#e3e3e3\" showStatus=\"true\"\r\n\t\t\t\t:status=\"socketStatus\">\r\n\t\t\t</uni-nav-bar>\r\n\t\t</view>\r\n\t\t<scroll-view :animation=\"scrollAnimationData\" ref=\"scrollview\" @click=\"hideKey\" scroll-y=\"true\"\r\n\t\t\t:scroll-top=\"scrollTop\" class=\"scroll-view\" :style=\"chatBodyBottom\" :scroll-with-animation=\"false\">\r\n\t\t\t<view class=\"scroll-view-content\">\r\n\t\t\t\t<!--  #ifdef  APP-NVUE -->\r\n\r\n\t\t\t\t<refresh class=\"refresh\" @refresh=\"onrefresh\" @pullingdown=\"onpullingdown\"\r\n\t\t\t\t\t:display=\"refreshing ? 'show' : 'hide'\">\r\n\t\t\t\t\t<text class=\"indicator-text\">加载中 ...</text>\r\n\t\t\t\t\t<loading-indicator class=\"indicator\"></loading-indicator>\r\n\t\t\t\t</refresh>\r\n\t\t\t\t<!--  #endif -->\r\n\t\t\t\t<view class=\"\" v-for=\"(item,index) in msgList\" :key=\"index\" :id=\"'chatId_'+index\">\r\n\t\t\t\t\t<uni-chat-detail :list=\"msgList\" :item=\"item\" v-if=\"item.content.trim() !== ''\" :index=\"index\">\r\n\t\t\t\t\t</uni-chat-detail>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\r\n\t\t<view ref=\"foot\" :animation=\"footAnimationData\" class=\"flex-column-center\"\r\n\t\t\t:style=\"'bottom:'+ KeyboardHeight +'rpx;'\">\r\n\r\n\t\t\t<view id=\"bottomfoot\" class=\"bottom-foot-char flex-row-around\" style=\"font-size: 55rpx;\" ref=\"moreMenu\">\r\n\t\t\t\t<!--  #ifndef  H5 -->\r\n\t\t\t\t<image class=\"tb-nv\" src=\"../../static/image/keyboard.png\" mode=\"aspectFit\"\r\n\t\t\t\t\tstyle=\"margin-left: 20rpx;margin-right: 20rpx;\"></image>\r\n\t\t\t\t<!--  #endif -->\r\n\t\t\t\t<input v-model=\"msg\" :focus=\"focus\" @focus=\"inputFocus\" :confirm-hold=\"true\" :adjust-position=\"false\"\r\n\t\t\t\t\t:placeholder=placeholder class=\"dh-input\" type=\"text\" @confirm=\"sendMsg\" confirm-type=\"send\"\r\n\t\t\t\t\tstyle=\"margin-right: 20rpx;\" maxlength=\"2000\" />\r\n\t\t\t\t<button size=\"mini\" type=\"default\" @click=\"sendMsg\"\r\n\t\t\t\t\tstyle=\"background-color: #04BE02;border-color: #04BE02;height: 70rpx;padding-left: 10rpx;padding-right: 10rpx;margin: 0;\"><text\r\n\t\t\t\t\t\tstyle=\"color:#ffffff;font-size: 30rpx;\">发送</text></button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"safeArea\" :style=\"{ height: safeBottom + 'px'}\">\r\n\t\t</view>\r\n\t\t<view>\r\n\t\t\t<u-notify ref=\"uNotify\"></u-notify>\r\n\t\t\t<u-toast ref=\"uToast\"></u-toast>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\n\t// #ifdef APP-NVUE\r\n\tconst BindingX = uni.requireNativePlugin('bindingx');\r\n\tconst animation = uni.requireNativePlugin('animation');\r\n\t// #endif\r\n\timport {\r\n\t\tmapState\r\n\t} from 'vuex'\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tsystemInfo: uni.getSystemInfoSync(),\r\n\t\t\t\tbaseUrl: getApp().globalData.server,\r\n\t\t\t\ttoUid: 0,\r\n\t\t\t\tsessionId: '',\r\n\t\t\t\tfootAnimationData: {},\r\n\t\t\t\tscrollAnimationData: {},\r\n\t\t\t\ttitle: '',\r\n\t\t\t\tchatSrcollBottom: 0,\r\n\t\t\t\tKeyboardHeight: 0,\r\n\t\t\t\tsafeBottom: 0,\r\n\t\t\t\tadjustPosition: true,\r\n\t\t\t\tmsgList: [],\r\n\t\t\t\tmsg: \"\",\r\n\t\t\t\tscrollTop: 0,\r\n\t\t\t\tsrcollHeight: 0,\r\n\t\t\t\tchatDetailHeight: 0,\r\n\t\t\t\twillStop: false,\r\n\t\t\t\tinitPoint: {\r\n\t\t\t\t\tidentifier: 0,\r\n\t\t\t\t\tY: 0\r\n\t\t\t\t},\r\n\t\t\t\tchatDetailBoxMaxWidth: 0,\r\n\t\t\t\tfocus: false,\r\n\t\t\t\trefreshing: false,\r\n\t\t\t\tready: false,\r\n\t\t\t\tisWxapp: false,\r\n\t\t\t\tisLogin: false,\r\n\t\t\t\tloading: false,\r\n\t\t\t\tloginType: '',\r\n\t\t\t\tnavTip: '',\r\n\t\t\t\tsource: null,\r\n\t\t\t\tparentId: 1,\r\n\t\t\t\ttoken: '',\r\n\t\t\t\tisDone: true,\r\n\t\t\t\tisFirst: true,\r\n\t\t\t\tscrollTop: 0,\r\n\t\t\t\tfromId: '',\r\n\t\t\t\ttoId: '',\r\n\t\t\t\tfromMsg: '',\r\n\t\t\t\ttoMsg: '',\r\n\t\t\t\tmsgAll: [],\r\n\t\t\t\tids: [],\r\n\t\t\t\trememberContext: false,\r\n\t\t\t\tallAI: false,\r\n\t\t\t\tplaceholder: '',\r\n\t\t\t\tisStartAllAI: false,\r\n\t\t\t\tsessionId2: '-1',\r\n\t\t\t\trole: 'assistant',\r\n\t\t\t\tparentId2: 1,\r\n\t\t\t\tisDebug: false,\r\n\t\t\t\timgGen: false,\r\n\t\t\t\tisSync: false,\r\n\t\t\t\tstatus: true,\r\n\t\t\t\tsocketStatus: false,\r\n\t\t\t\tstartInx: 0\r\n\t\t\t}\r\n\t\t},\r\n\t\tdestroyed() {\r\n\r\n\t\t},\r\n\t\tonLoad(option) {\r\n\t\t\tthis.safeBottom = this.systemInfo.safeAreaInsets.bottom > 0 ? this.systemInfo.safeAreaInsets.bottom : 0;\r\n\t\t\t// this.KeyboardHeight = this.safeBottom * 2;\r\n\t\t\tthis.sessionId = option.id;\r\n\t\t\tthis.title = option.name;\r\n\t\t\tthis.navTip = option.name;\r\n\t\t\tthis.chatDetailBoxMaxWidth = this.systemInfo.screenWidth - 110;\r\n\t\t\tthis.isLogin = uni.getStorageSync('is_login');\r\n\t\t\tthis.loginType = uni.getStorageSync('login_type');\r\n\t\t\tthis.status = uni.getStorageSync('status');\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\t// #ifndef  APP-NVUE\r\n\t\t\tthis.isWxapp = true;\r\n\t\t\t// #endif\r\n\t\t\tthis.onKeyboardHeight();\r\n\t\t\tthis.safeBottom = this.systemInfo.safeAreaInsets.bottom > 0 ? this.systemInfo.safeAreaInsets.bottom : 0;\r\n\t\t\t// this.KeyboardHeight = this.safeBottom * 2;\r\n\t\t\tthis.srcollHeight = this.systemInfo.screenHeight - this.systemInfo.statusBarHeight - 25 - this.safeBottom - 55;\r\n\t\t\t// #ifdef  MP-WEIXIN\r\n\t\t\tthis.srcollHeight = this.systemInfo.screenHeight - this.systemInfo.statusBarHeight - 10 - this.safeBottom - 55;\r\n\t\t\t// #endif\r\n\t\t\tthis.msgList = []\r\n\t\t\tvar that = this;\r\n\t\t\tthis.isLogin = uni.getStorageSync('is_login');\r\n\t\t\tthis.loginType = uni.getStorageSync('login_type');\r\n\t\t\tthis.token = uni.getStorageSync('token')\r\n\t\t\tthis.rememberContext = uni.getStorageSync('remember_context');\r\n\t\t\tlet all = uni.getStorageSync('all_ai');\r\n\t\t\tif (all === true) {\r\n\t\t\t\tthis.allAI = true;\r\n\t\t\t\tthis.placeholder = \"请输入起始语句\";\r\n\t\t\t}\r\n\t\t\tuni.$on('onStatus', this.onStatus)\r\n\t\t\tuni.$on('onMessage', this.onMessage)\r\n\t\t\tthis.isDebug = uni.getStorageSync('isDebug');\r\n\t\t\tlet gen = uni.getStorageSync('ai_gen_img');\r\n\t\t\tif (gen === true) {\r\n\t\t\t\tthis.imgGen = true;\r\n\t\t\t\tthis.placeholder = \"请输入图片描述\";\r\n\t\t\t}\r\n\t\t\tthis.isSync = uni.getStorageSync('sync_session');\r\n\t\t\tthis.status = uni.getStorageSync('status');\r\n\t\t\tthis.socketStatus = getApp().globalData.$socket && getApp().globalData.$socket.isOnline\r\n\t\t\tthis.getChatList();\r\n\t\t\t// uni.removeStorageSync('chatList');\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\tthis.scrollToBottom();\r\n\t\t\tthis.ready = true;\r\n\t\t},\r\n\t\tonShareAppMessage(res) {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: getApp().globalData.name,\r\n\t\t\t\tpath: '/pages/chat/session',\r\n\t\t\t\timageUrl: '/static/image/share_screen_slot.png'\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonShareTimeline: function(res) {\r\n\t\t\treturn {\r\n\t\t\t\ttitle: getApp().globalData.name,\r\n\t\t\t}\r\n\t\t},\r\n\t\tonPullDownRefresh() {\r\n\t\t\t// this.getSessionListRes();\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tchatBodyBottom() {\r\n\t\t\t\treturn `height:${this.srcollHeight}px;`\r\n\t\t\t},\r\n\t\t},\r\n\t\tonHide() {\r\n\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tonMessage: function(message) {\r\n\t\t\t\t// console.log(JSON.stringify(message));\r\n\t\t\t\tif (message.conversationId !== this.sessionId) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.isDone = message.isDone;\r\n\t\t\t\tif (this.allAI && this.isStartAllAI) {\r\n\t\t\t\t\tmessage.isSend = this.role === 'user'\r\n\t\t\t\t}\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tif (!message.isDone) {\r\n\t\t\t\t\tif (message.isSuccess && message.id) {\r\n\t\t\t\t\t\tif (this.ids.indexOf(message.id) === -1) {\r\n\t\t\t\t\t\t\tthis.msgList.push(message)\r\n\t\t\t\t\t\t\tthis.ids.push(message.id);\r\n\t\t\t\t\t\t\tthis.navTip = '正在打字中...'\r\n\t\t\t\t\t\t\tthis.toId = message.id\r\n\t\t\t\t\t\t\tif (this.allAI && this.isStartAllAI) {\r\n\t\t\t\t\t\t\t\tif (this.role === 'user') {\r\n\t\t\t\t\t\t\t\t\tthis.parentId2 = message.id;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.parentId = message.id;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.parentId = message.id;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfor (let i = this.msgList.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\t\t\tlet msg = this.msgList[i];\r\n\t\t\t\t\t\t\t\tif (msg.id === message.id) {\r\n\t\t\t\t\t\t\t\t\tmsg.content = message.content;\r\n\t\t\t\t\t\t\t\t\tmsg.html = message.html;\r\n\t\t\t\t\t\t\t\t\tthis.toMsg = msg.content;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//错误消息\r\n\t\t\t\t\t\tif (!message.isSuccess) {\r\n\t\t\t\t\t\t\t//错误消息\r\n\t\t\t\t\t\t\tthis.msgList.push(message)\r\n\t\t\t\t\t\t\tif (this.allAI && this.isStartAllAI) {\r\n\t\t\t\t\t\t\t\tthis.isStartAllAI = false;\r\n\t\t\t\t\t\t\t\tthis.placeholder = \"请输入起始语句\";\r\n\t\t\t\t\t\t\t\tthis.msg = '';\n\t\t\t\t\t\t\t\tthis.update2Store();\r\n\t\t\t\t\t\t\t\treturn this.showToast('已停止!', 'success');\r\n\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif (message.isDone) {\r\n\t\t\t\t\tthis.navTip = this.title\r\n\t\t\t\t\tif (message.isSuccess && this.toId) {\r\n\t\t\t\t\t\tif (this.loginType === 'pwd' || this.loginType === 'token') {\r\n\t\t\t\t\t\t\t// 新会话\r\n\t\t\t\t\t\t\tif (!this.sessionId || this.sessionId == '-1') {\r\n\t\t\t\t\t\t\t\tthis.getSessionListRes(true)\r\n\t\t\t\t\t\t\t} else if (this.allAI && this.sessionId2 == '-1') {\r\n\t\t\t\t\t\t\t\tif (this.role === 'user') {\r\n\t\t\t\t\t\t\t\t\tthis.getSessionListRes(false)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (this.allAI && this.isStartAllAI) {\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\tthat.sendMsg4Ai(that.toMsg)\r\n\t\t\t\t\t\t\t}, 3500);\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!message.isSuccess) {\r\n\t\t\t\t\t\t//错误消息\r\n\t\t\t\t\t\tthis.msgList.push(message)\r\n\t\t\t\t\t\tif (this.allAI && this.isStartAllAI) {\r\n\t\t\t\t\t\t\tthis.isStartAllAI = false;\r\n\t\t\t\t\t\t\tthis.placeholder = \"请输入起始语句\";\r\n\t\t\t\t\t\t\tthis.msg = '';\r\n\t\t\t\t\t\t\tthis.update2Store();\n\t\t\t\t\t\t\treturn this.showToast('已停止!', 'success');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\tthis.update2Store();\r\n\t\t\t},\r\n\t\t\tonStatus: function(status) {\r\n\t\t\t\tthis.socketStatus = status;\r\n\t\t\t},\r\n\t\t\tonKeyboardHeight: function() {\r\n\t\t\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\t\t\tthis.translatePageTop(res.height);\r\n\t\t\t\t\tif (this.systemInfo.platform == \"android\") {\r\n\t\t\t\t\t\tif (res.height > 100) {\r\n\t\t\t\t\t\t\tthis.chatSrcollBottom = res.height - this.safeBottom;\r\n\t\t\t\t\t\t\t//this.inputScroll();\r\n\t\t\t\t\t\t\t//this.translatePageTop(res.height);\r\n\t\t\t\t\t\t\t// #ifdef  MP-WEIXIN\r\n\t\t\t\t\t\t\tthis.KeyboardHeight = this.safeBottom * 2 + 70\r\n\t\t\t\t\t\t\tthis.srcollHeight = this.systemInfo.screenHeight - this.systemInfo\r\n\t\t\t\t\t\t\t\t.statusBarHeight - 10 - this.safeBottom - 100;\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.chatSrcollBottom = 0;\r\n\t\t\t\t\t\t\t// #ifdef  MP-WEIXIN\r\n\t\t\t\t\t\t\tthis.KeyboardHeight = this.safeBottom * 2\r\n\t\t\t\t\t\t\tthis.srcollHeight = this.systemInfo.screenHeight - this.systemInfo\r\n\t\t\t\t\t\t\t\t.statusBarHeight - 10 - this.safeBottom - 55;\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (res.height > 300) {\r\n\r\n\t\t\t\t\t\t\tthis.chatSrcollBottom = res.height - this.safeBottom;\r\n\t\t\t\t\t\t\t//this.translatePageTop(res.height);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.chatSrcollBottom = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (res.height === 0) {\r\n\t\t\t\t\t\t//this.translatePageBottom();\r\n\t\t\t\t\t\tthis.focus = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tonpullingdown: function(event) {\r\n\r\n\t\t\t},\r\n\t\t\ttranslatePageTop: function(h) {\r\n\r\n\t\t\t\t// #ifndef  APP-NVUE\r\n\t\t\t\tvar scrollAnimation = uni.createAnimation({\r\n\t\t\t\t\tduration: 220,\r\n\t\t\t\t\ttimingFunction: 'ease',\r\n\t\t\t\t})\r\n\r\n\t\t\t\tvar footAnimation = uni.createAnimation({\r\n\t\t\t\t\tduration: 220,\r\n\t\t\t\t\ttimingFunction: 'ease',\r\n\t\t\t\t})\r\n\t\t\t\tif (h == 0) {\r\n\t\t\t\t\tscrollAnimation.translateY(-h).step()\r\n\t\t\t\t\tfootAnimation.translateY(-h).step()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tscrollAnimation.translateY(-h + 34).step()\r\n\t\t\t\t\tfootAnimation.translateY(-h + 34).step()\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tthis.scrollAnimationData = scrollAnimation.export()\r\n\t\t\t\tthis.footAnimationData = footAnimation.export()\r\n\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\t// #ifdef  APP-NVUE\r\n\t\t\t\tlet foot = this.getEl(this.$refs.foot);\r\n\t\t\t\tlet scrollview = this.getEl(this.$refs.scrollview);\r\n\t\t\t\th = h - this.safeBottom;\r\n\t\t\t\tanimation.transition(scrollview, {\r\n\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\ttransform: 'translateY(-' + h + ')',\r\n\t\t\t\t\t},\r\n\t\t\t\t\tduration: 220, //ms\r\n\t\t\t\t\ttimingFunction: 'linear',\r\n\t\t\t\t\tneedLayout: false,\r\n\t\t\t\t\tdelay: 0 //ms\r\n\t\t\t\t}, function() {\r\n\r\n\t\t\t\t})\r\n\t\t\t\tanimation.transition(foot, {\r\n\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\ttransform: 'translateY(-' + h + ')',\r\n\t\t\t\t\t},\r\n\t\t\t\t\tduration: 220, //ms\r\n\t\t\t\t\ttimingFunction: 'linear',\r\n\t\t\t\t\tneedLayout: false,\r\n\t\t\t\t\tdelay: 0 //ms\r\n\t\t\t\t}, function() {\r\n\r\n\t\t\t\t})\r\n\t\t\t\t// #endif\r\n\r\n\r\n\r\n\t\t\t},\r\n\t\t\tinputScroll: function() {\r\n\t\t\t\tlet foot = this.getEl(this.$refs.foot);\r\n\t\t\t\tif (this.chatSrcollBottom) {\r\n\t\t\t\t\tvar translateY = -10;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar translateY = 0;\r\n\t\t\t\t}\r\n\t\t\t\tlet translateFoot = BindingX.bind({\r\n\t\t\t\t\teventType: 'timing',\r\n\t\t\t\t\texitExpression: 't>1',\r\n\t\t\t\t\tprops: [{\r\n\t\t\t\t\t\telement: foot,\r\n\t\t\t\t\t\tproperty: 'transform.translateY',\r\n\t\t\t\t\t\texpression: 'easeInOutSine(t,0,' + translateY + ',1)'\r\n\t\t\t\t\t}]\r\n\t\t\t\t}, (res) => {\r\n\t\t\t\t\tif (res.state === 'exit') {\r\n\t\t\t\t\t\tBindingX.unbind({\r\n\t\t\t\t\t\t\ttoken: translateFoot\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tscrollToBottom() {\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tuni.createSelectorQuery().in(this).select('.scroll-view-content').boundingClientRect((res) => {\r\n\t\t\t\t\t\tlet top = res.height - this.srcollHeight;\r\n\t\t\t\t\t\tif (top > 0) {\r\n\t\t\t\t\t\t\tthis.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).exec()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//隐藏键盘\r\n\t\t\thideKey: function() {\r\n\t\t\t\tuni.hideKeyboard()\r\n\t\t\t\tthis.inputFocus();\r\n\t\t\t},\r\n\t\t\t//ref\r\n\t\t\tgetEl: function(el) {\r\n\t\t\t\tif (typeof el === 'string' || typeof el === 'number') return el;\r\n\t\t\t\tif (WXEnvironment) {\r\n\t\t\t\t\treturn el.ref;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn el instanceof HTMLElement ? el : el.$el;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinputFocus: function() {\r\n\t\t\t\tvar that = this;\r\n\r\n\t\t\t\t// #ifndef  APP-NVUE\r\n\r\n\r\n\t\t\t\tif (this.showMore) {\r\n\t\t\t\t\tlet move = uni.upx2px(180);\r\n\t\t\t\t\tvar menuAnimation = uni.createAnimation({\r\n\t\t\t\t\t\tduration: 220,\r\n\t\t\t\t\t\ttimingFunction: 'ease',\r\n\t\t\t\t\t})\r\n\t\t\t\t\tmenuAnimation.translateX(0).step()\r\n\r\n\t\t\t\t\tthis.showMore = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// #endif\r\n\r\n\r\n\t\t\t\t// #ifdef  APP-NVUE\r\n\t\t\t\tthis.adjustPosition = true;\r\n\t\t\t\tif (this.showMore) {\r\n\t\t\t\t\tlet moreMenu = this.getEl(this.$refs.moreMenu);\r\n\t\t\t\t\tanimation.transition(moreMenu, {\r\n\t\t\t\t\t\tstyles: {\r\n\t\t\t\t\t\t\ttransform: 'translateX(0)',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tduration: 400, //ms\r\n\t\t\t\t\t\ttimingFunction: 'linear',\r\n\t\t\t\t\t\tneedLayout: false,\r\n\t\t\t\t\t\tdelay: 0 //ms\r\n\t\t\t\t\t}, function(res) {\r\n\t\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.showMore = false;\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\tsendMsg: function() {\r\n\t\t\t\tif (!this.status) {\r\n\t\t\t\t\tthis.showNotify('服务器正在维护中~', 'error');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.msg || this.msg.trim() === '') {\r\n\t\t\t\t\treturn this.showToast('请输入内容~', 'error');\r\n\t\t\t\t}\r\n\t\t\t\tif (this.allAI) {\r\n\t\t\t\t\tif (this.isStartAllAI) {\r\n\t\t\t\t\t\tif (this.msg === '停止') {\r\n\t\t\t\t\t\t\tthis.isStartAllAI = false;\r\n\t\t\t\t\t\t\tthis.placeholder = \"请输入起始语句\";\r\n\t\t\t\t\t\t\tthis.msg = '';\r\n\t\t\t\t\t\t\treturn this.showToast('停止成功!', 'success');\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn this.showToast('无效输入~', 'error');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.isDone) {\r\n\t\t\t\t\treturn this.showToast('还在回答问题呢,不要着急哦~', 'error');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet message = {\r\n\t\t\t\t\tcontent: this.msg,\r\n\t\t\t\t\thtml: this.msg,\r\n\t\t\t\t\tisSend: true,\r\n\t\t\t\t\tisSuccess: true,\r\n\t\t\t\t\tcreateTime: (new Date()).getTime(),\r\n\t\t\t\t\tid: this.$store.state.utils.uuid(),\r\n\t\t\t\t\trole: \"user\"\r\n\t\t\t\t}\r\n\t\t\t\tthis.fromId = message.id\r\n\t\t\t\tlet data = {\r\n\t\t\t\t\t\"authValue\": \"Bearer \" + this.token,\r\n\t\t\t\t\t\"content\": message.content,\r\n\t\t\t\t\t\"parentId\": this.parentId,\r\n\t\t\t\t\t\"id\": message.id\r\n\t\t\t\t};\r\n\t\t\t\tif (!this.isLogin) {\r\n\t\t\t\t\tdata.isDemo = true\r\n\t\t\t\t}\r\n\t\t\t\tif (this.sessionId != '-1') {\r\n\t\t\t\t\tdata.conversationId = this.sessionId;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.loginType === 'api') {\r\n\t\t\t\t\tdata.authType = 'api'\r\n\t\t\t\t\tlet msg_ = {\r\n\t\t\t\t\t\trole: 'user',\r\n\t\t\t\t\t\tcontent: this.msg\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet msgParam = [];\r\n\t\t\t\t\tmsgParam.push(msg_)\r\n\t\t\t\t\tdata.messages = msgParam;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.msg != \"\") {\r\n\t\t\t\t\tthis.msgList.push(message)\r\n\t\t\t\t\tif (this.allAI) {\r\n\t\t\t\t\t\tthis.isStartAllAI = true\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.loginType === 'api' || !this.isLogin) {\n\t\t\t\t\t\tdata.content = \"\";\r\n\t\t\t\t\t\tif (this.rememberContext) {\r\n\t\t\t\t\t\t\tdata.messages = [];\r\n\t\t\t\t\t\t\tlet index = this.msgList.length - 4;\r\n\t\t\t\t\t\t\tif (index < 0) {\r\n\t\t\t\t\t\t\t\tindex = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor (let i = index; i < this.msgList.length; i++) {\r\n\t\t\t\t\t\t\t\tlet msg_ = this.msgList[i]\r\n\t\t\t\t\t\t\t\tif (msg_.isSuccess && !msg_.isImg) {\r\n\t\t\t\t\t\t\t\t\tdata.messages.push(msg_)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet msg_ = {\r\n\t\t\t\t\t\t\t\trole: 'user',\r\n\t\t\t\t\t\t\t\tcontent: this.msg\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet msgParam = [];\r\n\t\t\t\t\t\t\tmsgParam.push(msg_)\r\n\t\t\t\t\t\t\tdata.messages = msgParam;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this.imgGen) {\r\n\t\t\t\t\t\t\tdata.isGenImg = true\n\t\t\t\t\t\t\tdata.content = this.msg\n\t\t\t\t\t\t\tdata.messages = []\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\n\t\t\t\t\tif (this.isDebug) {\n\t\t\t\t\t\tdata.content = this.msg\n\t\t\t\t\t\tdata.messages = []\n\t\t\t\t\t}\r\n\t\t\t\t\tif ((this.isDebug || !this.isLogin || !this.isSync || this.loginType === 'api') && this\r\n\t\t\t\t\t\t.sessionId == '-1') {\r\n\t\t\t\t\t\tthis.sessionId = this.$store.state.utils.uuid();\r\n\t\t\t\t\t\tlet list = uni.getStorageSync('sessionList');\r\n\t\t\t\t\t\tif (!list || list.length === 0) {\r\n\t\t\t\t\t\t\tlist = [];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet session = {\r\n\t\t\t\t\t\t\tcreateTime: (new Date()).getTime(),\r\n\t\t\t\t\t\t\tupdateTime: (new Date()).getTime(),\r\n\t\t\t\t\t\t\tid: this.sessionId,\r\n\t\t\t\t\t\t\ttitle: '会话' + (list.length + 1)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!this.isDebug && !this.isSync && (this.loginType === 'pwd' || this.loginType ===\r\n\t\t\t\t\t\t\t\t'token')) {\r\n\t\t\t\t\t\t\tthis.sessionId = '-1';\r\n\t\t\t\t\t\t\tsession.id = '-1'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlist.push(session);\r\n\t\t\t\t\t\tuni.setStorageSync('sessionList', list)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata.conversationId = this.sessionId;\r\n\t\t\t\t\tthis.navTip = '正在思考中...'\r\n\t\t\t\t\tthis.isDone = false\r\n\t\t\t\t\tlet that = this;\r\n\t\t\t\t\tthis.update2Store();\r\n\t\t\t\t\tthis.updateSessionList();\r\n\t\t\t\t\tthis.msg = \"\";\r\n\t\t\t\t\tgetApp().globalData.$socket.sendMessage(JSON.stringify(data), (isSucc, res) => {\r\n\t\t\t\t\t\tif (!isSucc) {\r\n\t\t\t\t\t\t\tthat.navTip = that.title\r\n\t\t\t\t\t\t\tthat.isDone = true\r\n\t\t\t\t\t\t\tthat.isStartAllAI = false\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.fromMsg = this.msg;\r\n\r\n\t\t\t\t}\r\n\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\tif (this.allAI && this.isStartAllAI) {\r\n\t\t\t\t\tthis.placeholder = \"输入'停止'终止会话\";\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tsendMsg4Ai: function(msg) {\r\n\t\t\t\tif (!msg || msg.trim() === '') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet message = {\r\n\t\t\t\t\tcontent: msg,\r\n\t\t\t\t\thtml: msg,\r\n\t\t\t\t\tisSend: this.role === \"user\",\r\n\t\t\t\t\tcreateTime: (new Date()).getTime(),\r\n\t\t\t\t\tid: this.$store.state.utils.uuid(),\r\n\t\t\t\t\trole: this.role\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet data = {\r\n\t\t\t\t\t\"authValue\": \"Bearer \" + this.token,\r\n\t\t\t\t\t\"content\": message.content,\r\n\t\t\t\t\t\"parentId\": this.parentId,\r\n\t\t\t\t\t\"id\": message.id,\r\n\t\t\t\t\tisSender: this.role === \"user\"\r\n\t\t\t\t};\r\n\t\t\t\tif (!this.isLogin) {\r\n\t\t\t\t\tdata.isDemo = true\r\n\t\t\t\t}\r\n\t\t\t\tif (this.role === 'user') {\r\n\t\t\t\t\tdata.conversationId = this.sessionId;\r\n\t\t\t\t\tdata.parentId = this.parentId\r\n\t\t\t\t}\r\n\t\t\t\tif (this.role === 'assistant') {\r\n\t\t\t\t\tdata.conversationId = this.sessionId2;\r\n\t\t\t\t\tdata.parentId = this.parentId2\r\n\t\t\t\t}\r\n\t\t\t\tif (this.loginType === 'api' || !this.isLogin) {\r\n\t\t\t\t\tdata.authType = 'api'\r\n\t\t\t\t}\r\n\t\t\t\tif (msg != \"\") {\r\n\t\t\t\t\tif (this.loginType === 'api' || !this.isLogin) {\n\t\t\t\t\t\tdata.content = \"\";\r\n\t\t\t\t\t\tif (this.rememberContext) {\r\n\t\t\t\t\t\t\tdata.messages = [];\r\n\t\t\t\t\t\t\tlet index = this.msgList.length - 4;\r\n\t\t\t\t\t\t\tif (index < 0) {\r\n\t\t\t\t\t\t\t\tindex = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfor (let i = index; i < this.msgList.length; i++) {\r\n\t\t\t\t\t\t\t\tlet msg_ = this.msgList[i]\r\n\t\t\t\t\t\t\t\tif (msg_.isSuccess && !msg_.isImg) {\r\n\t\t\t\t\t\t\t\t\tdata.messages.push(msg_)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlet msg_ = {\r\n\t\t\t\t\t\t\t\trole: 'user',\r\n\t\t\t\t\t\t\t\tcontent: msg\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet msgParam = [];\r\n\t\t\t\t\t\t\tmsgParam.push(msg_)\r\n\t\t\t\t\t\t\tdata.messages = msgParam;\r\n\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.navTip = '正在思考中...'\r\n\t\t\t\t\tthis.isDone = false\r\n\t\t\t\t\tlet that = this;\r\n\t\t\t\t\tdata.conversationId = this.sessionId;\r\n\t\t\t\t\tgetApp().globalData.$socket.sendMessage(JSON.stringify(data), (isSucc, res) => {\r\n\t\t\t\t\t\tif (!isSucc) {\r\n\t\t\t\t\t\t\tthat.navTip = that.title\r\n\t\t\t\t\t\t\tthis.isDone = true\r\n\t\t\t\t\t\t\tthat.isStartAllAI = false\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tif (this.role === 'user') {\r\n\t\t\t\t\t\tthis.role = 'assistant'\r\n\t\t\t\t\t} else if (this.role === 'assistant') {\r\n\t\t\t\t\t\tthis.role = 'user'\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tthis.scrollToBottom();\r\n\t\t\t},\r\n\t\t\tgetChatList: function() {\r\n\t\t\t\tif (!this.sessionId || this.sessionId == '-1') {\r\n\t\t\t\t\tthis.parentId = 1;\r\n\t\t\t\t\tthis.msgList = []\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.sessionId == '99999999') {\r\n\t\t\t\t\tlet message = {\r\n\t\t\t\t\t\tcontent: '你好',\r\n\t\t\t\t\t\thtml: '你好',\r\n\t\t\t\t\t\tisSend: true,\r\n\t\t\t\t\t\tcreateTime: (new Date()).getTime(),\r\n\t\t\t\t\t\tid: this.$store.state.utils.uuid(),\r\n\t\t\t\t\t\trole: 'user'\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.msgList.push(message)\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.startInx = this.startInx + 1\r\n\t\t\t\t\tthis.getDemoChatListRes();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.getChatListFromStore()\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if (!this.isDebug && this.isSync && (!list || list.length === 0) && (this.loginType === 'pwd' || this\r\n\t\t\t\t// \t\t.loginType ===\r\n\t\t\t\t// \t\t'token')) {\r\n\t\t\t\t// \tthis.getChatListRes();\r\n\t\t\t\t// }\r\n\r\n\t\t\t},\r\n\r\n\t\t\tgetChatListRes: function() {\r\n\t\t\t\tif (!this.sessionId || this.sessionId == '-1') {\r\n\t\t\t\t\tthis.navTip = ' 新会话'\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tthis.navTip = '加载中'\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '正在同步消息...'\r\n\t\t\t\t});\r\n\t\t\t\tlet header = {};\r\n\t\t\t\tlet token = uni.getStorageSync('token')\r\n\t\t\t\tif (token) {\r\n\t\t\t\t\theader = {\r\n\t\t\t\t\t\t\"Authorization\": \"Bearer \" + token\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(\">>request messageList...\");\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: that.baseUrl + '/backend-api/conversation?id=' + that\r\n\t\t\t\t\t\t.sessionId,\r\n\t\t\t\t\tdata: {},\r\n\t\t\t\t\theader: header,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t\t\t\tthat.loading = false\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tif (res.data.status === '000000') {\r\n\t\t\t\t\t\t\tif (res.data.messageList) {\r\n\t\t\t\t\t\t\t\tthat.navTip = that.title\r\n\t\t\t\t\t\t\t\tthat.msgList = res.data.messageList;\r\n\t\t\t\t\t\t\t\tthat.update2Store()\r\n\t\t\t\t\t\t\t\tthat.parentId = that.msgList[that.msgList.length - 1].id\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthat.navTip = '服务出错'\r\n\t\t\t\t\t\t\treturn that.showNotify('服务出错!', 'error');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t\t\t\tthat.navTip = '服务出错'\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\treturn that.showNotify('服务出错!', 'error');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetChatListFromStore: function() {\r\n\t\t\t\tlet list = [];\r\n\t\t\t\tlet chatList = uni.getStorageSync('chatList');\r\n\t\t\t\tif (chatList) {\r\n\t\t\t\t\tlist = chatList[this.sessionId]\r\n\t\t\t\t\tif (list) {\r\n\t\t\t\t\t\tthis.msgList.push(...list)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (list && list.length > 0) {\r\n\r\n\t\t\t\t\tthis.parentId = this.msgList[this.msgList.length - 1].id\r\n\r\n\t\t\t\t}\n\t\t\t\tthis.scrollToBottom();\r\n\t\t\t},\r\n\t\t\tupdate2Store: function() {\r\n\t\t\t\tlet chatList = uni.getStorageSync('chatList');\r\n\t\t\t\tif (!chatList) {\r\n\t\t\t\t\tchatList = {};\r\n\t\t\t\t}\r\n\t\t\t\tchatList[this.sessionId] = this.msgList.slice(this.startInx);\r\n\t\t\t\tuni.setStorageSync('chatList', chatList)\r\n\t\t\t},\r\n\r\n\t\t\tmoderations: function(id, msg) {\r\n\t\t\t\tlet data = {\r\n\t\t\t\t\tconversationId: this.sessionId,\r\n\t\t\t\t\tcontent: msg,\r\n\t\t\t\t\tid: id\r\n\t\t\t\t}\r\n\t\t\t\tlet header = {};\r\n\t\t\t\tlet token = uni.getStorageSync('token')\r\n\t\t\t\tif (token) {\r\n\t\t\t\t\theader = {\r\n\t\t\t\t\t\t\"Authorization\": \"Bearer \" + token,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: that.baseUrl + '/backend-api/moderation',\r\n\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\theader: header,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.data.status !== '000000') {\r\n\t\t\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetSessionListRes: function(isThisSession) {\r\n\t\t\t\tif (this.isDebug || !(this.loginType === 'pwd' || this.loginType === 'token')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tlet header = {};\r\n\t\t\t\tlet token = uni.getStorageSync('token')\r\n\t\t\t\tif (token) {\r\n\t\t\t\t\theader = {\r\n\t\t\t\t\t\t\"Authorization\": \"Bearer \" + token,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(\">>request sessionList...\");\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: that.baseUrl + '/backend-api/conversations',\r\n\t\t\t\t\tdata: {},\r\n\t\t\t\t\theader: header,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.data.status === '000000') {\r\n\t\t\t\t\t\t\tif (res.data.list) {\r\n\r\n\t\t\t\t\t\t\t\tif (isThisSession && (!that.sessionId || that.sessionId == '-1')) {\r\n\t\t\t\t\t\t\t\t\tthat.sessionId = res.data.list[0].id\r\n\t\t\t\t\t\t\t\t\tif (that.isSync) {\r\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('sessionList', res.data.list)\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tlet list = uni.getStorageSync('sessionList');\r\n\t\t\t\t\t\t\t\t\t\tif (list) {\r\n\t\t\t\t\t\t\t\t\t\t\tlist[list.length - 1].id = that.sessionId\r\n\t\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('sessionList', list)\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// that.moderations(this.fromId, this.fromMsg);\r\n\t\t\t\t\t\t\t\t\tthat.genTitle()\r\n\t\t\t\t\t\t\t\t\t// that.moderations(this.toId, this.toMsg);\r\n\t\t\t\t\t\t\t\t\tthat.update2Store()\r\n\r\n\t\t\t\t\t\t\t\t\t// uni.removeStorageSync('sessionList');\r\n\r\n\t\t\t\t\t\t\t\t} else if (!isThisSession && that.sessionId2 == '-1') {\r\n\t\t\t\t\t\t\t\t\tthat.sessionId2 = res.data.list[0].id\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\r\n\r\n\t\t\t},\r\n\t\t\tgenTitle: function() {\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tlet data = {\r\n\t\t\t\t\tconversationId: this.sessionId,\r\n\t\t\t\t\tid: this.toId\r\n\t\t\t\t}\r\n\t\t\t\tlet header = {};\r\n\t\t\t\tlet token = uni.getStorageSync('token')\r\n\t\t\t\tif (token) {\r\n\t\t\t\t\theader = {\r\n\t\t\t\t\t\t\"Authorization\": \"Bearer \" + token,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: that.baseUrl + '/backend-api/gentitle',\r\n\t\t\t\t\tmethod: \"POST\",\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\theader: header,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.data.status === '000000') {\r\n\t\t\t\t\t\t\tif (res.data.title) {\r\n\t\t\t\t\t\t\t\tthat.navTip = res.data.title\r\n\t\t\t\t\t\t\t\tthat.title = res.data.title\r\n\t\t\t\t\t\t\t\tlet list = uni.getStorageSync('sessionList');\r\n\t\t\t\t\t\t\t\tif (list) {\r\n\t\t\t\t\t\t\t\t\tif (that.isSync) {\r\n\t\t\t\t\t\t\t\t\t\tlist[0].title = res.data.title\r\n\t\t\t\t\t\t\t\t\t\tuni.setStorageSync('sessionList', list)\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tlist[list.length - 1] = that.sessionId\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// that.getSessionListRes()\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tupdateSessionList: function() {\r\n\t\t\t\tif (this.sessionId == '-1' || this.sessionId == '99999999') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet list = uni.getStorageSync('sessionList');\r\n\t\t\t\tif (list && list.length > 0) {\r\n\t\t\t\t\tfor (let i = 0; i < list.length; i++) {\r\n\t\t\t\t\t\tlet session = list[i];\r\n\t\t\t\t\t\tif (session.id === this.sessionId) {\r\n\t\t\t\t\t\t\tsession.updateTime = (new Date()).getTime()\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.setStorageSync('sessionList', list)\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\t\t\tgetDemoChatListRes: function() {\r\n\t\t\t\tif (!this.sessionId || this.sessionId == '-1') {\r\n\t\t\t\t\tthis.navTip = ' 新会话'\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tthis.navTip = '加载中'\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '加载中...'\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log(\">>request demo messageList...\");\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: that.baseUrl + '/demoChatList',\r\n\t\t\t\t\tdata: {},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t\t\t\tthat.loading = false\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tthat.navTip = that.title\r\n\t\t\t\t\t\tif (res.data.status === '000000') {\r\n\t\t\t\t\t\t\tif (res.data.messageList && res.data.messageList.length > 0) {\r\n\t\t\t\t\t\t\t\tthat.startInx = this.startInx + res.data.messageList.length\r\n\t\t\t\t\t\t\t\tthat.msgList.push(...res.data.messageList)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthat.getChatListFromStore();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\tthat.navTip = that.title\r\n\t\t\t\t\t\tthat.getChatListFromStore();\r\n\t\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tshowNotify(title, type) {\r\n\r\n\t\t\t\tthis.$refs.uNotify.show({\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tmessage: title,\r\n\t\t\t\t\tduration: 1000 * 3,\r\n\t\t\t\t\tsafeAreaInsetTop: true\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tshowToast(msg, type) {\r\n\r\n\t\t\t\tthis.$refs.uToast.show({\r\n\t\t\t\t\tmessage: msg,\r\n\t\t\t\t\ttype: type,\r\n\t\t\t\t\tduration: 2000,\r\n\t\t\t\t\tposition: 'bottom'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.scroll-view {\r\n\t\twidth: 750rpx;\r\n\t\tbackground-color: #e3e3e3;\r\n\t}\r\n\r\n\t.tis {\r\n\t\twidth: 100%;\r\n\t\theight: 10vw;\r\n\r\n\t\tjustify-content: center;\r\n\t\tfont-size: 24rpx !important;\r\n\t\tcolor: white !important;\r\n\t}\r\n\r\n\t.ing {\r\n\t\twidth: 100%;\r\n\r\n\t}\r\n\r\n\r\n\t.header-dh {\r\n\t\tposition: fixed;\r\n\t\tjustify-content: flex-end;\r\n\t\tpadding-bottom: 15rpx;\r\n\t\twidth: 750rpx;\r\n\t\tbackground-color: #f1f1f1;\r\n\t\tz-index: 20;\r\n\t}\r\n\r\n\t.padding-chat {\r\n\t\tpadding: 22rpx;\r\n\t}\r\n\r\n\t.margin-right {\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\r\n\t.margin-left {\r\n\t\tmargin-left: 20rpx;\r\n\t}\r\n\r\n\t.padding-left {\r\n\t\tpadding-left: 20rpx;\r\n\t}\r\n\r\n\t.flex-column-start {\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.flex-row-around {\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: space-around;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.flex-row-between {\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.status_bar-fixed {\r\n\t\twidth: 750rpx;\r\n\t\tbackground-color: #f1f1f1;\r\n\t\tz-index: 20;\r\n\t}\r\n\r\n\t.center-box {\r\n\t\twidth: 720rpx;\r\n\t\tpadding-left: 25rpx;\r\n\t}\r\n\r\n\t.dh-input {\r\n\t\tfont-size: 30rpx;\r\n\t\t/* #ifdef H5 */\r\n\t\twidth: 610rpx;\r\n\t\t/* #endif */\r\n\t\t/* #ifndef H5 */\r\n\t\twidth: 560rpx;\r\n\t\t/* #endif */\r\n\t\theight: 70rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\tpadding-left: 15rpx;\r\n\t\tbackground-color: #FFFFFF;\r\n\t\t/* #ifdef H5 */\r\n\t\tmargin-left: 40rpx;\r\n\t\t/* #endif */\r\n\r\n\r\n\r\n\t}\r\n\r\n\t.tb-nv {\r\n\t\twidth: 50rpx;\r\n\t\theight: 50rpx;\r\n\t}\r\n\r\n\t.wid {\r\n\t\twidth: 480rpx;\r\n\t}\r\n\r\n\t.box-normal {\r\n\t\twidth: 750rpx;\r\n\t\theight: 0;\r\n\t\tbackground-color: #FFFFFF;\r\n\t}\r\n\r\n\t.flex-row-around {\r\n\t\tflex-direction: row;\r\n\t\tjustify-content: space-around;\r\n\t\talign-items: center;\r\n\t\tflex-wrap: wrap;\r\n\t}\r\n\r\n\t.tb-text {\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.flex-column-center {\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tposition: fixed !important;\r\n\t\tbackground-color: #f3f3f3;\r\n\t\tborder-radius: 10rpx;\r\n\t\tz-index: 9999999;\r\n\t\twidth: 100%;\r\n\t\t/* #ifndef APP-NVUE */\r\n\t\tpadding-bottom: constant(safe-area-inset-bottom);\r\n\t\tpadding-bottom: env(safe-area-inset-bottom);\r\n\t\t/* #endif */\r\n\r\n\t}\r\n\r\n\t.safeArea {\r\n\t\twidth: 750rpx;\r\n\t\tposition: fixed;\r\n\t\tbottom: 0px;\r\n\t\tbackground-color: #f3f3f3;\r\n\t}\r\n\r\n\t.padding-top {\r\n\t\tpadding-top: 10rpx;\r\n\t}\r\n\r\n\t.padding-right {\r\n\t\tpadding-right: 20rpx;\r\n\t}\r\n\r\n\t.justify-end {\r\n\t\tflex-direction: row-reverse;\r\n\t}\r\n\r\n\t.nv-chat {\r\n\t\tflex-wrap: wrap-reverse;\r\n\t}\r\n\r\n\t.nv-row {\r\n\t\tflex-direction: row\r\n\t}\r\n\r\n\t.nv-rowever {\r\n\t\tflex-direction: row-reverse\r\n\t}\r\n\r\n\t.white-bg {\r\n\t\tbackground-color: #95eb67;\r\n\t}\r\n\r\n\t.gr-bg {\r\n\t\tbackground-color: #ffffff;\r\n\t}\r\n\r\n\t.long-text {\r\n\t\tcolor: #ffffff;\r\n\t\tfont-size: 28rpx;\r\n\t\tpadding: 8 20rpx;\r\n\t}\r\n\r\n\r\n\t.chat-time {\r\n\t\ttext-align: center;\r\n\t\tpadding-top: 18rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #8f8f8f;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\r\n\t.system-msg {\r\n\t\ttext-align: center;\r\n\t\tpadding-top: 18rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #8f8f8f;\r\n\t}\r\n\r\n\t.ing {\r\n\t\ttop: 50rpx;\r\n\t\tposition: absolute;\r\n\t\ttext-align: center;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.scroll-view_H {\r\n\t\tflex-direction: row;\r\n\t\tpadding-top: 60rpx;\r\n\t\tpadding-bottom: 60rpx;\r\n\t\theight: 380rpx;\r\n\t\twidth: 750rpx;\r\n\t\tflex-wrap: wrap;\r\n\t}\r\n\r\n\t.refresh {\r\n\t\twidth: 750rpx;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.indicator-text {\r\n\t\tcolor: #888888;\r\n\t\ttext-align: center;\r\n\t\tfont-size: 28rpx;\r\n\t\tmargin-bottom: 10rpx;\r\n\t}\r\n\r\n\t.indicator {\r\n\t\tpadding-top: 2rpx;\r\n\t\tpadding-bottom: 32rpx;\r\n\t\theight: 60rpx;\r\n\t\twidth: 60rpx;\r\n\t\tcolor: #888888;\r\n\t}\r\n</style>\n","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1679467227399\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import mod from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=1&id=6e1957d8&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.nvue?vue&type=style&index=1&id=6e1957d8&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1679467227434\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}