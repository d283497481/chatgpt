(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chat/session"],{"0b05":function(t,n,e){},"0b61":function(t,n,e){"use strict";(function(t){var i=e("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=i(e("9523")),o=e("26cb"),a=i(e("c526"));function r(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,i)}return e}var u={data:function(){return{extraIconChat:{color:"#4cd964",size:"44",type:"chatbubble"},options:[{text:"标为已读",style:{backgroundColor:"#4c4c4c"}},{text:"删除",style:{backgroundColor:"#fa5151"}}],uid:"",safeBottom:"",tabbarHeight:"",dropdownlist:"padding:10rpx;",isLogin:!1,sessionList:[],loading:!1,loginType:"",navTip:"会话列表",showDemoTips:!0,isDebug:!1,isSync:!1,isAnno:!1,announcement:""}},mixins:[a.default],watch:{},onLoad:function(){var n=t.getStorageSync("status");n?this.getAnnouncement():(this.isAnno=!0,this.announcement="服务器正在维护中~"),t.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onShareAppMessage:function(t){return{title:getApp().globalData.name,path:"/pages/chat/session",imageUrl:"/static/image/share_screen_slot.png"}},onShareTimeline:function(t){return{title:getApp().globalData.name}},computed:function(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?r(Object(e),!0).forEach((function(n){(0,s.default)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):r(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}({},(0,o.mapState)({token:function(t){return t.token}})),onPullDownRefresh:function(){"pwd"!==this.loginType&&"token"!==this.loginType||!this.isSync||this.getSessionListRes()},onReachBottom:function(){},onHide:function(){t.hideKeyboard()},onUnload:function(){},onShow:function(){if(this.isLogin=t.getStorageSync("is_login"),this.loginType=t.getStorageSync("login_type"),this.isSync=t.getStorageSync("sync_session"),this.sessionList=[],this.isDebug=t.getStorageSync("isDebug"),this.getSessionList(),this.sessionList&&this.sessionList.length>0){var n=t.getStorageSync("chatList");if(n)for(var e=0;e<this.sessionList.length;e++){var i=this.sessionList[e].id,s=n[i];if(s){var o=s[s.length-1].content;o&&(o=o.replaceAll("\n","")),this.sessionList[e].keywords=o}}}},onReady:function(){this.searchBoxH=2*(this.systemInfo.windowHeight-this.systemInfo.statusBarHeight-36-12),this.tabbarHeight=2*this.systemInfo.windowBottom},methods:{chatWindow:function(n,e){t.navigateTo({url:"/pages/chat/chat?id="+n+"&name="+e})},swipeClick:function(n,e){if(1===n.index)try{var i="chat_sessions_".concat(this.user._id),s=t.getStorageSync(i),o=s[e].id;s.splice(e,1);var a="chatDetail_".concat(this.user._id,"_").concat(o);t.setStorageSync(a,[]),t.setStorageSync(i,s)}catch(n){console.log(n)}else n.index},getSessionList:function(){var n=t.getStorageSync("sessionList"),e=!0;if(n||(n=[],e=!1),!this.isLogin){var i={createTime:(new Date).getTime(),id:"99999999",title:"Demo Chat"};n.push(i)}if("pwd"===this.loginType||"token"===this.loginType)return this.isSync&&0===n.length&&!e&&this.getSessionListRes(),this.isSync&&n.length>0&&(this.sessionList=n),void(!this.isSync&&n.length>0&&(this.sessionList=n.reverse()));!this.isDebug&&"api"!==this.loginType&&this.isLogin||(this.sessionList=n.reverse())},getSessionListRes:function(){var n=this;n.loading=!0,n.navTip="加载中",t.showLoading({title:"正在同步会话..."});var e={},i=t.getStorageSync("token");i&&(e={Authorization:"Bearer "+i}),console.log(">>request sessionList..."),t.request({url:getApp().globalData.server+"/backend-api/conversations",data:{},header:e,success:function(e){return t.stopPullDownRefresh(),t.hideLoading(),n.loading=!1,"000000"!==e.data.status?(n.navTip="服务出错",n.showNotify("服务出错!","error")):(n.navTip="会话列表",e.data.list?(n.sessionList=e.data.list,t.setStorageSync("sessionList",n.sessionList),n.showNotify("同步成功!","success")):void 0)},fail:function(e){return n.loading=!1,t.stopPullDownRefresh(),n.navTip="服务出错",t.hideLoading(),n.showNotify("服务出错!","error")}})},getAnnouncement:function(){var n=this;console.log(">>request announcement..."),t.request({url:getApp().globalData.server+"/announcement",data:{},success:function(t){if("000000"===t.data.status){var e=t.data.content;e&&"null"!==e?(n.isAnno=!0,n.announcement=e):(n.isAnno=!1,n.announcement="")}else console.log(t.data)},fail:function(t){console.log(t)}})},showNotify:function(t,n){this.$refs.uNotify.show({type:n,message:t,duration:3e3,safeAreaInsetTop:!0})},showToast:function(t){this.$refs.uToast.show({message:t,type:"error",duration:2e3,position:"bottom"})}}};n.default=u}).call(this,e("543d")["default"])},"2f50":function(t,n,e){"use strict";(function(t,n){var i=e("4ea4");e("cd32"),e("a9ff");i(e("66fd"));var s=i(e("b469"));t.__webpack_require_UNI_MP_PLUGIN__=e,n(s.default)}).call(this,e("bc2e")["default"],e("543d")["createPage"])},"42ca":function(t,n,e){"use strict";var i=e("98ac"),s=e.n(i);s.a},"7f5f":function(t,n,e){"use strict";e.r(n);var i=e("0b61"),s=e.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){e.d(n,t,(function(){return i[t]}))}(o);n["default"]=s.a},8502:function(t,n,e){"use strict";var i=e("0b05"),s=e.n(i);s.a},"8ad9":function(t,n,e){"use strict";var i=e("eca1"),s=e.n(i);s.a},"98ac":function(t,n,e){},b469:function(t,n,e){"use strict";e.r(n);var i=e("d692"),s=e("7f5f");for(var o in s)["default"].indexOf(o)<0&&function(t){e.d(n,t,(function(){return s[t]}))}(o);e("8ad9"),e("42ca"),e("8502");var a=e("f0c5"),r=Object(a["a"])(s["default"],i["b"],i["c"],!1,null,"6db1e0ee",null,!1,i["a"],void 0);n["default"]=r.exports},d692:function(t,n,e){"use strict";e.d(n,"b",(function(){return s})),e.d(n,"c",(function(){return o})),e.d(n,"a",(function(){return i}));var i={uniNavBar:function(){return e.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(e.bind(null,"38f7"))},uniNoticeBar:function(){return e.e("uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar").then(e.bind(null,"b268"))},uniList:function(){return e.e("uni_modules/uni-list/components/uni-list/uni-list").then(e.bind(null,"b588"))},uniSwipeAction:function(){return e.e("uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action").then(e.bind(null,"b39c"))},uniSwipeActionItem:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item")]).then(e.bind(null,"94cb"))},uniListChat:function(){return e.e("uni_modules/uni-list/components/uni-list-chat/uni-list-chat").then(e.bind(null,"a54e"))},uNotify:function(){return Promise.all([e.e("common/vendor"),e.e("uni_modules/uview-ui/components/u-notify/u-notify")]).then(e.bind(null,"52a0"))},uToast:function(){return e.e("uni_modules/uview-ui/components/u-toast/u-toast").then(e.bind(null,"193b"))}},s=function(){var t=this,n=t.$createElement,e=(t._self._c,t.__map(t.sessionList,(function(n,e){var i=t.__get_orig(n),s=t.$store.state.utils.formatChatTime(n.createTime);return{$orig:i,g0:s}})));t.$mp.data=Object.assign({},{$root:{l0:e}})},o=[]},eca1:function(t,n,e){}},[["2f50","common/runtime","common/vendor"]]]);